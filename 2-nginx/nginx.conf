events {
    worker_connections 1024;
}

http {
    # Define rate limit zone: 10mb can hold ~160,000 IP addresses
    # Rate: 10 requests per minute (10r/m)
    limit_req_zone $binary_remote_addr zone=mylimit:10m rate=10r/m;

    server {
        listen 80;
        server_name localhost;

        # Include MIME types
        include /etc/nginx/mime.types;
        default_type application/octet-stream;

        location / {
            # Apply rate limiting - allow up to 10 requests instantly, block the 11th
            limit_req zone=mylimit burst=9 nodelay;
            
            # Custom error page for rate limit exceeded
            limit_req_status 429;

            root /usr/share/nginx/html;
            index index.html;
        }

        # Custom error page for 429 (Too Many Requests)
        error_page 429 /429.html;
        location = /429.html {
            root /usr/share/nginx/html;
            internal;
        }
    }
}
